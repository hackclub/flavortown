<% content_for :title, "Project ##{@project.id}" %>
<h1>Project #<%= @project.id %></h1>

<% if @project.deleted? %>
  <div class="alert alert-warning" style="margin-bottom: 1.5rem; padding: 1rem; background: #fee2e2; border-radius: 8px; border: 1px solid #dc2626; color: hsl(7, 40%, 25%);">
    <strong>⚠️ This project was deleted at <%= @project.deleted_at.strftime("%Y-%m-%d %H:%M") %></strong>
  </div>
<% end %>

<div class="flex" style="gap: 1rem; flex-wrap: wrap;">
  <div class="card">
    <h2>Details</h2>
    <div class="info-rows">
      <div><b>Title:</b> <%= @project.title %></div>
      <div><b>Description:</b> <%= @project.description.presence || "None" %></div>
      <div><b>Has Banner:</b> <%= @project.banner.present? ? "Yes" : "No" %></div>
      <div><b>Ship Status:</b> <%= @project.ship_status.titleize %></div>
      <div><b>Devlog Count:</b> <%= @project.devlogs.count %></div>
      <div><b>Time Spent: </b> <%= distance_of_time_in_words(@project.duration_seconds) %></div>
      <div><b>Type:</b> <%= @project.project_type.presence || "Not set" %></div>
      <div><b>Created:</b> <%= @project.created_at.strftime("%Y-%m-%d") %></div>
      <div><b>Deleted:</b> <%= @project.deleted? ? "Yes" : "No" %></div>
    </div>
  </div>

  <div class="card">
    <h2>Members</h2>
    <% if @project.users.any? %>
      <ul style="margin: 0; padding-left: 1.25rem;">
        <% @project.users.each do |u| %>
          <li><%= link_to u.display_name, helper_user_path(u) %></li>
        <% end %>
      </ul>
    <% else %>
      <p>No members.</p>
    <% end %>
  </div>
</div>

<div style="display: flex; gap: 0.5rem;">
  <%= link_to "← Back", helper_projects_path, class: "btn-secondary no-margin" %>
  <% if @project.deleted? %>
    <%= button_to "Restore Project", restore_helper_project_path(@project),
      method: :post,
      class: "btn-primary",
      form: { onsubmit: "return confirm('Are you sure you want to restore this project?')" } %>
  <% else %>
    <%= button_to "View Project", project_path(@project),
      method: :get,
      class: "btn-primary",
      form: { target: "_blank", rel: "noopener" } %>
  <% end %>

  <% if @project.repo_url.present? && (URI.parse(@project.repo_url).scheme.in?(%w[http https]) rescue false) %>
    <%= link_to "View Repo", @project.repo_url, class: "btn-primary", target: "_blank", rel: "noopener" %>
  <% end %>

  <% if @project.demo_url.present? && (URI.parse(@project.demo_url).scheme.in?(%w[http https]) rescue false) %>
    <%= link_to "View Demo", @project.demo_url, class: "btn-primary", target: "_blank", rel: "noopener" %>
  <% end %>

  <% if @project.readme_url.present? && (URI.parse(@project.readme_url).scheme.in?(%w[http https]) rescue false) %>
    <%= link_to "View Readme", @project.readme_url, class: "btn-primary", target: "_blank", rel: "noopener" %>
  <% end %>
</div>
