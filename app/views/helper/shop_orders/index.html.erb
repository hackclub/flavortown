<h1>Shop Orders</h1>

<%= form_with url: helper_shop_orders_path, method: :get, local: true, class: "form-basic" do %>
  <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem;">
    <%= text_field_tag :user_search, params[:user_search],
      placeholder: "Search by user name...",
      autocomplete: "off",
      class: "input-primary" %>
    <%= select_tag :status,
      options_for_select([
        ["All Statuses", ""],
        ["Pending", "pending"],
        ["Awaiting Fulfillment", "awaiting_periodical_fulfillment"],
        ["Fulfilled", "fulfilled"],
        ["Rejected", "rejected"],
        ["On Hold", "on_hold"]
      ], params[:status]),
      class: "input-primary" %>
    <%= submit_tag "Filter", class: "btn-primary slim" %>
  </div>
<% end %>

<% if @orders.any? %>
  <table class="table-data">
    <thead>
      <tr>
        <th>ID</th>
        <th>User</th>
        <th>Item</th>
        <th>Qty</th>
        <th>Status</th>
        <th>Date</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @orders.each do |o| %>
        <tr>
          <td><%= o.id %></td>
          <td><%= link_to o.user.display_name, helper_user_path(o.user) %></td>
          <td><%= o.shop_item&.name || "Unknown" %></td>
          <td><%= o.quantity %></td>
          <td><span class="badge badge-<%= o.aasm_state %>"><%= o.aasm_state.titleize %></span></td>
          <td><%= o.created_at.strftime("%Y-%m-%d") %></td>
          <td><%= link_to "View", helper_shop_order_path(o), class: "btn-primary slim" %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>No orders found.</p>
<% end %>

<% if @pagy.pages > 1 %>
  <div class="pagination"><%== @pagy.series_nav %></div>
<% end %>

<%= link_to "â† Back", helper_root_path, class: "btn-secondary", style: "margin-top: 1rem;" %>

<style>
  .badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: 500;
    display: inline-block;
  }

  .badge-pending { background-color: #fbbf24; color: #78350f; }
  .badge-awaiting_periodical_fulfillment { background-color: #60a5fa; color: #1e3a8a; }
  .badge-fulfilled { background-color: #10b981; color: white; }
  .badge-rejected { background-color: #ef4444; color: white; }
  .badge-on_hold { background-color: #6b7280; color: white; }
</style>
