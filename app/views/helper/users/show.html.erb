<h1>User #<%= @user.id %></h1>

<% if @user.banned? %>
  <div class="alert alert--danger" style="margin-bottom: 1rem;">
    <strong>üö´ This user is banned</strong>
  </div>
<% end %>

<div class="flex" style="gap: 1rem; flex-wrap: wrap;">
  <div class="card">
    <h2>Basic Info</h2>
    <div class="info-rows">
      <div><b>Name:</b> <%= @user.display_name %></div>
      <div><b>Slack ID:</b> <%= @user.slack_id || "N/A" %></div>
      <div><b>Verification:</b> <%= @user.verification_status.titleize %></div>
      <div><b>YSWS Eligible:</b> <%= @user.ysws_eligible? ? "Yes" : "No" %></div>
      <div><b>Vote Balance:</b> <%= @user.vote_balance %></div>
      <div><b>Has Hackatime:</b> <%= @user.has_hackatime? ? "Yes" : "No" %></div>
      <div><b>Joined:</b> <%= @user.created_at.strftime("%Y-%m-%d") %></div>
    </div>
  </div>

  <div class="card">
    <h2>Moderation</h2>
    <div class="info-rows">
      <div><b>‚ö†Ô∏è User Banned:</b> <%= @user.banned? ? "Yes" : "No" %></div>
      <% if @user.banned? && @user.banned_reason.present? %>
        <div><b>- Reason:</b> <%= @user.banned_reason %></div>
        <div><b>- Since:</b> <%= @user.banned_at.strftime("%Y-%m-%d %H:%M") %></div>
      <% end %>
      <% if @user.shadow_banned? %>
        <div><b>‚ÑπÔ∏è Visibility Restricted (do not tell user, contact an admin if needed)</b></div>
        <% if @user.shadow_banned_reason.present? %>
          <div><b>- Reason:</b> <%= @user.shadow_banned_reason %></div>
        <% end %>
        <% if @user.shadow_banned_at.present? %>
          <div><b>- Since:</b> <%= @user.shadow_banned_at.strftime("%Y-%m-%d %H:%M") %></div>
        <% end %>
      <% end %>
    </div>
  </div>

  <div class="card">
    <h2>Projects (<%= @user.projects.size %>)</h2>
    <% if @user.projects.any? %>
      <ul style="margin: 0; padding-left: 1.25rem;">
        <% @user.projects.limit(10).each do |p| %>
          <li><%= link_to p.title, helper_project_path(p) %></li>
        <% end %>
        <% if @user.projects.size > 10 %>
          <li><em>... and <%= @user.projects.size - 10 %> more</em></li>
        <% end %>
      </ul>
    <% else %>
      <p>No projects.</p>
    <% end %>
  </div>

  <% deleted_projects = Project.unscoped.deleted.joins(:memberships).where(project_memberships: { user_id: @user.id }) %>
  <% if deleted_projects.any? %>
    <div class="card">
      <h2 style="color: #dc2626;">Deleted Projects (<%= deleted_projects.size %>)</h2>
      <ul style="margin: 0; padding-left: 1.25rem;">
        <% deleted_projects.limit(10).each do |p| %>
          <li>
            <%= link_to p.title, helper_project_path(p) %>
            <span class="badge badge-danger" style="margin-left: 0.5rem;">Deleted</span>
          </li>
        <% end %>
        <% if deleted_projects.size > 10 %>
          <li><em>... and <%= deleted_projects.size - 10 %> more</em></li>
        <% end %>
      </ul>
      <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
        Click on a project to view details and restore it.
      </p>
    </div>
  <% end %>

  <div class="card">
    <h2>Shop Orders</h2>
    <% orders = @user.shop_orders.order(created_at: :desc).limit(10) %>
    <% if orders.any? %>
      <ul style="margin: 0; padding-left: 1.25rem;">
        <% orders.each do |o| %>
          <li>
            <%= link_to "##{o.id}", helper_shop_order_path(o) %> -
            <%= o.shop_item&.name || "Unknown" %> (<%= o.aasm_state.titleize %>)
          </li>
        <% end %>
      </ul>
    <% else %>
      <p>No orders.</p>
    <% end %>
  </div>
</div>

<div style="display: flex; gap: 0.5rem;">
  <%= link_to "‚Üê Back", helper_users_path, class: "btn-secondary" %>

  <%= button_to "View Profile", user_path(@user),
    method: :get,
    class: "btn-primary",
    form: { target: "_blank", rel: "noopener" } %>
</div>
