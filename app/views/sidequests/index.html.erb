<% content_for :title, "Sidequests" %>
<% content_for :og_description, "Take on challenges for extra bonuses! Browse active and past sidequests on Flavortown." %>
<% content_for :og_image, og_image_url('sidequests', format: :png) %>
<% content_for :twitter_card, "summary_large_image" %>

<%= render HeadingComponent.new(title: "Sidequests", tone: :green, size: :full) %>

<div class="sidequests-index">
  <h1 class="sidequests-index__subtitle">Looking for a sidequest? Take on one of these challenges for extra bonuses!</h1>

  <% if @db_sidequests.any? %>
    <div class="sidequests-index__cards">
      <% @db_sidequests.each do |sidequest| %>
        <div class="sidequest-card sidequest-card--blue">
          <div class="sidequest-card__content">
            <h1 class="sidequest-card__title"><%= sidequest.title %></h1>
            <h2><%= sidequest.description %></h2>
            <% if sidequest.expires_at.present? %>
              <p class="sidequest-card__expires">Ends <%= sidequest.expires_at.strftime("%B %d, %Y") %></p>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if @active_sidequests.any? %>
    <div class="sidequests-index__cards">
      <% @active_sidequests.each do |sidequest| %>
        <%= render SidequestCardComponent.new(**sidequest) %>
      <% end %>
    </div>
  <% end %>

  <% if @active_sidequests.empty? && @db_sidequests.empty? %>
    <p class="sidequests-index__empty">No active sidequests right now. Check back soon!</p>
  <% end %>

  <% if @expired_sidequests.any? %>
    <h2 class="sidequests-index__section-title">Past Sidequests</h2>
    <div class="sidequests-index__cards">
      <% @expired_sidequests.each do |sidequest| %>
        <%= render SidequestCardComponent.new(**sidequest) %>
      <% end %>
    </div>
  <% end %>
</div>
