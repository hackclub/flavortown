<% content_for :title, @sidequest.title %>
<% content_for :og_description, truncate(@sidequest.description.to_s, length: 200) %>
<% content_for :og_image, og_image_url('sidequests', format: :png) %>
<% content_for :twitter_card, "summary_large_image" %>

<%= render HeadingComponent.new(title: @sidequest.title, tone: :blue, size: :full) %>

<div class="sidequest-show">
  <div class="sidequest-show__content">
    <% if @sidequest.description.present? %>
      <p class="sidequest-show__description"><%= @sidequest.description %></p>
    <% end %>

    <% if @sidequest.expires_at.present? %>
      <p class="sidequest-show__expires">
        <% if @sidequest.expires_at > Time.current %>
          Ends
        <% else %>
          Ended
        <% end %>
        <%= @sidequest.expires_at.strftime("%B %d, %Y") %>
        (<%= distance_of_time_in_words(Time.current, @sidequest.expires_at) %>
          <% if @sidequest.expires_at > Time.current %>
            left
          <% else %>
            ago
          <% end %>
        )
      </p>
    <% end %>

    <% if @approved_entries.any? %>
      <div class="sidequest-show__gallery">
        <h3 class="sidequest-show__gallery-title"><%= @approved_entries.size %> <%= "submission".pluralize(@approved_entries.size) %></h3>
        <div class="sidequest-show__gallery-grid">
          <% @approved_entries.each do |entry| %>
            <% project = entry.project %>
            <% next unless project.present? %>
            <div class="sidequest-show__gallery-item">
              <%= render partial: "projects/card", locals: { project: project } %>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="sidequest-show__stats">
        <p><strong>Be the first to submit</strong></p>
      </div>
    <% end %>

    <div class="sidequest-show__actions">
      <%= render ButtonComponent.new(
            text: "â† Back to Sidequests",
            href: sidequests_path,
            color: :brown,
            variant: :borderless
          ) %>
    </div>
  </div>
</div>
