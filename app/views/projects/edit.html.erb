<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="form-container">
      <div class="form-header">
        <h1>Edit Project</h1>
      </div>

      <%= form_with model: @project, local: true, multipart: true do |form| %>
        <% if @project.errors.any? %>
          <div class="form-errors">
            <h3><%= pluralize(@project.errors.count, "error") %> prohibited this project from being saved:</h3>
            <ul>
              <% @project.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="form-group">
          <%= form.label :title, "Title" %>
          <%= form.text_field :title, class: "form-field", placeholder: "Enter project title..." %>
        </div>

        <div class="form-group">
          <%= form.label :description, "Description" %>
          <%= form.text_area :description, class: "form-field form-field--textarea", placeholder: "Enter project description...", rows: 6 %>
        </div>

        <div class="form-group">
          <%= form.label :banner, "Banner Image" %>
          <div class="file-upload-area" id="banner-upload-area">
            <%= form.file_field :banner, accept: "image/*", class: "file-upload-input" %>
            <div class="file-upload-content">
              <% if @project.banner.attached? %>
                <%= image_tag @project.banner, class: "file-upload-preview", alt: "Banner preview" %>
                <div class="file-upload-text" style="margin-top: var(--space-s);">Click to change banner</div>
              <% else %>
                <button type="button" class="btn btn--yellow" style="pointer-events: none;">
                  Upload a banner
                </button>
              <% end %>
            </div>
          </div>
        </div>

        <div class="form-group">
          <%= form.label :readme_url, "Readme Link" %>
          <%= form.url_field :readme_url, class: "form-field", placeholder: "https://..." %>
        </div>

        <div class="form-group">
          <%= form.label :demo_url, "Demo Link" %>
          <%= form.url_field :demo_url, class: "form-field", placeholder: "https://..." %>
        </div>

        <div class="form-group">
          <%= form.label :repo_url, "Repository Link" %>
          <%= form.url_field :repo_url, class: "form-field", placeholder: "https://..." %>
        </div>

        <div class="form-actions">
          <%= link_to "Cancel", @project, class: "btn btn--yellow" %>
          <%= form.submit "Update Project", class: "btn btn--blue" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  // Handle file upload preview
  document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('banner-upload-area');
    const fileInput = uploadArea?.querySelector('input[type="file"]');

    if (fileInput) {
      fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            const preview = uploadArea.querySelector('.file-upload-preview');
            const content = uploadArea.querySelector('.file-upload-content');

            if (preview) {
              preview.src = e.target.result;
            } else {
              const img = document.createElement('img');
              img.src = e.target.result;
              img.className = 'file-upload-preview';
              content.innerHTML = '';
              content.appendChild(img);
              const text = document.createElement('div');
              text.className = 'file-upload-text';
              text.style.marginTop = 'var(--space-s)';
              text.textContent = 'Click to change banner';
              content.appendChild(text);
            }
            uploadArea.classList.add('has-file');
          };
          reader.readAsDataURL(file);
        }
      });

      // Handle drag and drop
      uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });

      uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
      });

      uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          fileInput.files = files;
          fileInput.dispatchEvent(new Event('change'));
        }
      });
    }
  });
</script>
