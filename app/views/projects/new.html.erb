<div class="projects-new">
  <div class="projects-new__container">
    <%= render(HeadingComponent.new(title: "Create a new Project", tone: :brown)) %>

    <%= form_with(model: @project, class: "projects-new__form", local: true, data: { controller: "project-form", action: "submit->project-form#onSubmit" }) do |form| %>
      <div class="projects-new__card">
        <div class="projects-new__field projects-new__field--title">
          <%= render(
                InputComponent.new(
                  label: "Project Title",
                  placeholder: "Give your project a name",
                  form: form,
                  attribute: :title,
                  color: :yellow,
                  subtitle: "A clear title helps people find your work.",
                  input_html: {
                    data: {
                      action: "input->project-form#validateTitle blur->project-form#validateTitle",
                      "project-form-target": "title"
                    }
                  }
                )
              ) %>
        </div>

        <div class="projects-new__field projects-new__field--description">
          <%= render(
                InputComponent.new(
                  label: "Description",
                  placeholder: "Share what the project does, who's working on it, and what's next.",
                  form: form,
                  attribute: :description,
                  color: :red,
                  as: :textarea,
                  input_html: {
                    rows: 4,
                    data: {
                      action: "input->project-form#validateDescription blur->project-form#validateDescription",
                      "project-form-target": "description"
                    }
                  },
                  subtitle: "Use a few sentences to explain what you're making."
                )
              ) %>
        </div>

        <div class="projects-new__field projects-new__field--banner">
          <%= render(
                FileUploadComponent.new(
                  label: "Project Banner",
                  form: form,
                  attribute: :banner,
                  color: :green,
                  subtitle: "Upload a JPEG, PNG, WEBP, HEIC, or HEIF up to 10 MB.",
                  accept: Project::ACCEPTED_CONTENT_TYPES.join(","),
                  direct_upload: true,
                  max_size: Project::MAX_BANNER_SIZE
                )
              ) %>
        </div>

        <div class="projects-new__field projects-new__field--links">
          <%= render InputGroupComponent.new(
                label: "Project Links",
                color: :blue,
                subtitle: "Share links to your project's resources."
              ) do %>

            <%= render InputComponent.new(
                  label: "Demo Link",
                  placeholder: "https://flavortown.cooked.selfhosted.hackclub.com/projects",
                  form: form,
                  attribute: :demo_url,
                  color: :blue,
                  icon: "icons/link.svg",
                  input_html: {
                    type: :url,
                    inputmode: "url",
                    data: {
                      action: "input->project-form#validateUrl blur->project-form#validateUrl",
                      "project-form-target": "demoUrl"
                    }
                  }
                ) %>

            <%= render InputComponent.new(
                  label: "Repository",
                  placeholder: "https://github.com/hackclub/flavortown",
                  form: form,
                  attribute: :repo_url,
                  color: :blue,
                  icon: "icons/merge.svg",
                  input_html: {
                    type: :url,
                    inputmode: "url",
                    data: {
                      action: "input->project-form#onRepoInput blur->project-form#onRepoBlur",
                      "project-form-target": "repoUrl"
                    }
                  }
                ) %>

            <div data-project-form-target="readmeContainer" hidden>
              <%= render InputComponent.new(
                    label: "Raw Readme Link",
                    placeholder: "https://raw.githubusercontent.com/hackclub/flavortown/refs/heads/main/README.md",
                    form: form,
                    attribute: :readme_url,
                    color: :blue,
                    icon: "icons/paper.svg",
                    input_html: {
                      type: :url,
                      inputmode: "url",
                      data: {
                        action: "input->project-form#onReadmeInput input->project-form#validateUrl blur->project-form#validateUrl",
                        "project-form-target": "readmeUrl"
                      }
                    }
                  ) %>
            </div>
          <% end %>
        </div>

        <div class="projects-new__field projects-new__field--hackatime-projects">
          <%= render(
                HackatimeProjectSelectorComponent.new(
                  label: "Hackatime Projects",
                  form: form,
                  attribute: :hackatime_project_ids,
                  color: :yellow,
                  projects: current_user.hackatime_projects,
                  project_times: @project_times,
                  subtitle: "Link this project to your Hackatime projects."
                )
              ) %>
        </div>
      </div>
      <div class="projects-new__actions" style="">
        <%= render(ButtonComponent.new(text: "Cancel", href: projects_path, color: :red, size: :md, icon: "icons/close.svg")) %>
        <%= render(ButtonComponent.new(text: "Create Project", color: :green, size: :md, icon: "icons/plus.svg", type: :submit, disable_with: "Creating...", data: { "project-form-target": "submit" })) %>
      </div>
    <% end %>
  </div>
</div>
