<div class="section previously-hosted">
  <h2 class="title">Previously, we hosted...</h2>

  <div class="events">
    <div class="event-card" data-event-key="summer-of-making">
      <%= image_tag "landing/previously-hosted/summer-of-making.webp", alt: "Summer of Making", loading: "lazy" %>
      <h3>Summer of Making</h3>
      <h4>Summer 2025</h4>
    </div>

    <div class="event-card" data-event-key="high-seas">
      <%= image_tag "landing/previously-hosted/high-seas.webp", alt: "High Seas", loading: "lazy" %>
      <h3>High Seas</h3>
      <h4>Winter 2024</h4>
    </div>

    <div class="event-card" data-event-key="arcade">
      <%= image_tag "landing/previously-hosted/arcade.webp", alt: "Arcade", loading: "lazy" %>
      <h3>Arcade</h3>
      <h4>Summer 2024</h4>
    </div>
  </div>

  <div class="stats" data-default-event="summer-of-making">
    <h3 class="stats-title">For Summer of Making...</h3>
    <div class="big-stats">
      <div class="stat">
        <%= image_tag "landing/previously-hosted/participants-badge.webp", alt: "Stat Icon", loading: "lazy" %>
        <h4>10,000</h4>
        <h5>high schoolers participated</h5>
      </div>

      <div class="stat">
        <%= image_tag "landing/previously-hosted/hours-logged-badge.webp", alt: "Stat Icon", loading: "lazy" %>
        <h4>500,000</h4>
        <h5>hours logged</h5>
      </div>

      <div class="stat">
        <%= image_tag "landing/previously-hosted/prizes-shipped-badge.webp", alt: "Stat Icon", loading: "lazy" %>
        <h4>99,999</h4>
        <h5>total prizes shipped</h5>
      </div>
    </div>

    <h2>That's including:</h2>
    <div class="prize-stats">
      <div class="prize">
        <%= image_tag "landing/previously-hosted/ipad.webp", alt: "Prize Stats", loading: "lazy" %>
        <h4>653 iPads</h4>
      </div>

      <div class="prize">
        <%= image_tag "landing/previously-hosted/ipad.webp", alt: "Prize Stats", loading: "lazy" %>
        <h4>653 iPads</h4>
      </div>

      <div class="prize">
        <%= image_tag "landing/previously-hosted/ipad.webp", alt: "Prize Stats", loading: "lazy" %>
        <h4>653 iPads</h4>
      </div>

      <div class="prize">
        <%= image_tag "landing/previously-hosted/ipad.webp", alt: "Prize Stats", loading: "lazy" %>
        <h4>653 iPads</h4>
      </div>

      <div class="prize">
        <%= image_tag "landing/previously-hosted/ipad.webp", alt: "Prize Stats", loading: "lazy" %>
        <h4>653 iPads</h4>
      </div>

      <div class="prize">
        <h4>and more!</h4>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const statsByEvent = <%= {
      "summer-of-making" => {
        title: "For Summer of Making...",
        stats: [
          { value: "10,000", label: "high schoolers participated", icon: image_path("landing/previously-hosted/participants-badge.webp") },
          { value: "500,000", label: "hours logged", icon: image_path("landing/previously-hosted/hours-logged-badge.webp") },
          { value: "99,999", label: "total prizes shipped to 999 countries", icon: image_path("landing/previously-hosted/prizes-shipped-badge.webp") }
        ]
      },
      "high-seas" => {
        title: "For High Seas...",
        stats: [
          { value: "7,234", label: "high schoolers participated", icon: image_path("landing/previously-hosted/participants-badge.webp") },
          { value: "243,000", label: "hours logged", icon: image_path("landing/previously-hosted/hours-logged-badge.webp") },
          { value: "67,000", label: "total prizes shipped to 670 countries", icon: image_path("landing/previously-hosted/prizes-shipped-badge.webp") }
        ]
      },
      "arcade" => {
        title: "For Arcade...",
        stats: [
          { value: "5,000", label: "high schoolers participated", icon: image_path("landing/previously-hosted/participants-badge.webp") },
          { value: "100,000", label: "hours logged", icon: image_path("landing/previously-hosted/hours-logged-badge.webp") },
          { value: "35,000", label: "total prizes shipped to 99 countries", icon: image_path("landing/previously-hosted/prizes-shipped-badge.webp") }
        ]
      }
    }.to_json.html_safe %>;

    const statsSection = document.querySelector(".previously-hosted .stats");
    if (!statsSection) return;

    const statsTitle = statsSection.querySelector(".stats-title");
    const statCards = Array.from(statsSection.querySelectorAll(".stat"));
    const eventCards = Array.from(document.querySelectorAll(".previously-hosted .event-card"));
    let activeCard = null;

    const updateNotchPosition = () => {
      if (!activeCard || !statsSection) return;
      const cardRect = activeCard.getBoundingClientRect();
      const statsRect = statsSection.getBoundingClientRect();
      const center = cardRect.left + cardRect.width / 2 - statsRect.left;
      statsSection.style.setProperty("--notch-x", `${center}px`);
    };

    const renderStats = (key) => {
      const payload = statsByEvent[key];
      if (!payload) return;
      statsTitle.textContent = payload.title;
      statCards.forEach((card, index) => {
        const info = payload.stats[index];
        if (!info) {
          card.hidden = true;
          return;
        }
        card.hidden = false;
        const img = card.querySelector("img");
        img.src = info.icon;
        img.alt = info.label;
        card.querySelector("h4").textContent = info.value;
        card.querySelector("h5").textContent = info.label;
      });
    };

    eventCards.forEach((card) => {
      card.addEventListener("click", () => {
        activeCard = card;
        eventCards.forEach((c) => c.classList.toggle("is-active", c === card));
        renderStats(card.dataset.eventKey);
        updateNotchPosition();
      });
    });

    const defaultKey = statsSection.dataset.defaultEvent || eventCards[0]?.dataset.eventKey;
    if (defaultKey) {
      renderStats(defaultKey);
      activeCard = eventCards.find((card) => card.dataset.eventKey === defaultKey) || eventCards[0];
      eventCards.forEach((card) => {
        card.classList.toggle("is-active", card === activeCard);
      });
      updateNotchPosition();
    }

    window.addEventListener("resize", updateNotchPosition);
  });
</script>
