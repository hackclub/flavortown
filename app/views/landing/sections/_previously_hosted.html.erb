<div class="previously-hosted-section-second-border-wrapper">
  <div class="previously-hosted-section-border-wrapper">
    <div class="section previously-hosted">
      <h2 class="title">Previously, we hosted...</h2>

      <div class="events">
        <div class="event-card" data-event-key="summer-of-making">
          <%= image_tag "landing/previously-hosted/summer-of-making.avif", alt: "Summer of Making", loading: "lazy", width: 705, height: 476 %>
          <h3><%= link_to "Summer of Making", "https://summer.hackclub.com", target: "_blank", rel: "noopener" %></h3>
          <h4>Summer 2025</h4>
        </div>

        <div class="event-card" data-event-key="high-seas">
          <%= image_tag "landing/previously-hosted/high-seas.avif", alt: "High Seas", loading: "lazy", width: 705, height: 476 %>
          <h3><%= link_to "High Seas", "https://highseas.hackclub.com", target: "_blank", rel: "noopener" %></h3>
          <h4>Winter 2024</h4>
        </div>

        <div class="event-card" data-event-key="arcade">
          <%= image_tag "landing/previously-hosted/arcade.avif", alt: "Arcade", loading: "lazy", width: 705, height: 476 %>
          <h3><%= link_to "Arcade", "https://hackclub.com/arcade", target: "_blank", rel: "noopener" %></h3>
          <h4>Summer 2024</h4>
        </div>
      </div>

      <div class="stats" data-default-event="summer-of-making">
        <h3 class="stats-title">For Summer of Making...</h3>
        <div class="big-stats">
          <div class="stat">
            <%= image_tag "landing/previously-hosted/participants-badge.avif", alt: "Stat Icon", loading: "lazy", width: 152, height: 152 %>
            <h4>10,000</h4>
            <h5>high schoolers participated</h5>
          </div>

          <div class="stat">
            <%= image_tag "landing/previously-hosted/hours-logged-badge.avif", alt: "Stat Icon", loading: "lazy", width: 152, height: 152 %>
            <h4>500,000</h4>
            <h5>hours logged</h5>
          </div>

          <div class="stat">
            <%= image_tag "landing/previously-hosted/prizes-shipped-badge.avif", alt: "Stat Icon", loading: "lazy", width: 152, height: 152 %>
            <h4>99,999</h4>
            <h5>total prizes shipped</h5>
          </div>
        </div>

        <h2>That's including:</h2>
        <div class="prize-stats">
          <div class="prize">
            <%= image_tag "landing/previously-hosted/ipad.avif", alt: "Prize Stats", loading: "lazy", width: 154, height: 116 %>
            <h3>653 iPads</h3>
          </div>

          <div class="prize">
            <%= image_tag "landing/previously-hosted/ipad.avif", alt: "Prize Stats", loading: "lazy", width: 154, height: 116 %>
            <h3>653 iPads</h3>
          </div>

          <div class="prize">
            <%= image_tag "landing/previously-hosted/ipad.avif", alt: "Prize Stats", loading: "lazy", width: 154, height: 116 %>
            <h3>653 iPads</h3>
          </div>

          <div class="prize">
            <%= image_tag "landing/previously-hosted/ipad.avif", alt: "Prize Stats", loading: "lazy", width: 154, height: 116 %>
            <h3>653 iPads</h3>
          </div>

          <div class="prize">
            <%= image_tag "landing/previously-hosted/ipad.avif", alt: "Prize Stats", loading: "lazy", width: 154, height: 116 %>
            <h3>653 iPads</h3>
          </div>

          <div class="prize">
            <h3>and more!</h3>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const statsByEvent = <%= {
      "summer-of-making" => {
        title: "For Summer of Making...",
        stats: [
          { value: "4,141", label: "high schoolers participated", icon: image_path("landing/previously-hosted/participants-badge.avif") },
          { value: "80,370", label: "hours logged", icon: image_path("landing/previously-hosted/hours-logged-badge.avif") },
          { value: "5044", label: "total prizes shipped to 79 countries", icon: image_path("landing/previously-hosted/prizes-shipped-badge.avif") }
        ],
        prizes: [
          { image: image_path("landing/previously-hosted/macbook.avif"), label: "3 macbooks", width: 999, height: 822 },
          { image: image_path("landing/previously-hosted/ipad.avif"), label: "9 iPads", width: 256, height: 256 },
          { image: image_path("landing/previously-hosted/pinecil.avif"), label: "104 pinecils", width: 768, height: 768 },
          { image: image_path("landing/previously-hosted/factorio.avif"), label: "48 factorio copies", width: 960, height: 960 },
          { image: image_path("landing/previously-hosted/flipper.avif"), label: "31 flippers", width: 1045, height: 712 },
          { label: "and more!" }
        ]
      },
      "high-seas" => {
        title: "For High Seas...",
        stats: [
          { value: "1683", label: "high schoolers participated", icon: image_path("landing/previously-hosted/participants-badge.avif") },
          { value: "74,143", label: "hours logged", icon: image_path("landing/previously-hosted/hours-logged-badge.avif") },
          { value: "10,765", label: "total prizes shipped to 212 countries", icon: image_path("landing/previously-hosted/prizes-shipped-badge.avif") }
        ],
        prizes: [
          { image: image_path("landing/previously-hosted/defcon.avif"), label: "2 tickets to defcon", width: 1024, height: 768 },
          { image: image_path("landing/previously-hosted/rpi_5.avif"), label: "327 rpi 5s", width: 1000, height: 1000 },
          { image: image_path("landing/previously-hosted/ipad.avif"), label: "66 ipads", width: 256, height: 256 },
          { image: image_path("landing/previously-hosted/mac_mini.avif"), label: "27 mac minis", width: 500, height: 500 },
          { image: image_path("landing/previously-hosted/macbook.avif"), label: "11 macbooks", width: 999, height: 822 },
          { label: "and more!" }
        ]
      },
      "arcade" => {
        title: "For Arcade...",
        stats: [
          { value: "2709", label: "high schoolers participated", icon: image_path("landing/previously-hosted/participants-badge.avif") },
          { value: "124,348", label: "hours logged", icon: image_path("landing/previously-hosted/hours-logged-badge.avif") },
          { value: "6440", label: "total prizes shipped to 131 countries", icon: image_path("landing/previously-hosted/prizes-shipped-badge.avif") }
        ],
        prizes: [
          { image: image_path("landing/previously-hosted/ipad.avif"), label: "120 ipads", width: 256, height: 256 },
          { image: image_path("landing/previously-hosted/quest_3.avif"), label: "18 quest 3s", width: 1024, height: 535 },
          { image: image_path("landing/previously-hosted/a1_mini.avif"), label: "53 bambu labs", width: 1000, height: 1333 },
          { image: image_path("landing/previously-hosted/thinkpad.avif"), label: "11 thinkpads", width: 1000, height: 1000 },
          { image: image_path("landing/previously-hosted/framework.avif"), label: "14 frameworks", width: 1024, height: 576 },
          { label: "and more!" }
        ]
      }
    }.to_json.html_safe %>;

    const statsSection = document.querySelector(".previously-hosted .stats");
    if (!statsSection) return;

    const statsTitle = statsSection.querySelector(".stats-title");
    const statCards = Array.from(statsSection.querySelectorAll(".stat"));
    const prizeCards = Array.from(statsSection.querySelectorAll(".prize"));
    const eventCards = Array.from(document.querySelectorAll(".previously-hosted .event-card"));
    let activeCard = null;

    const updateNotchPosition = () => {
      if (!activeCard || !statsSection) return;
      const cardRect = activeCard.getBoundingClientRect();
      const statsRect = statsSection.getBoundingClientRect();
      const center = cardRect.left + cardRect.width / 2 - statsRect.left;
      statsSection.style.setProperty("--notch-x", `${center}px`);
    };

    const renderStats = (key) => {
      const payload = statsByEvent[key];
      if (!payload) return;
      statsTitle.textContent = payload.title;
      statCards.forEach((card, index) => {
        const info = payload.stats[index];
        if (!info) {
          card.hidden = true;
          return;
        }
        card.hidden = false;
        const img = card.querySelector("img");
        img.src = info.icon;
        img.alt = info.label;
        card.querySelector("h4").textContent = info.value;
        card.querySelector("h5").textContent = info.label;
      });
      prizeCards.forEach((card, index) => {
        const prize = payload.prizes[index];
        if (!prize) {
          card.hidden = true;
          return;
        }
        card.hidden = false;
        const img = card.querySelector("img");
        if (img && prize.image) {
          img.src = prize.image;
          img.alt = prize.label;
          if (prize.width) img.width = prize.width;
          if (prize.height) img.height = prize.height;
        }
        card.querySelector("h3").textContent = prize.label;
      });
    };

    eventCards.forEach((card) => {
      card.addEventListener("click", () => {
        activeCard = card;
        eventCards.forEach((c) => c.classList.toggle("is-active", c === card));
        renderStats(card.dataset.eventKey);
        updateNotchPosition();
      });
    });

    const defaultKey = statsSection.dataset.defaultEvent || eventCards[0]?.dataset.eventKey;
    if (defaultKey) {
      renderStats(defaultKey);
      activeCard = eventCards.find((card) => card.dataset.eventKey === defaultKey) || eventCards[0];
      eventCards.forEach((card) => {
        card.classList.toggle("is-active", card === activeCard);
      });
      updateNotchPosition();
    }

    window.addEventListener("resize", updateNotchPosition);
  });
</script>
