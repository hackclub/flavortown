<% content_for :title, "Order Review Queue" %>
<h1>Order Review Queue</h1>

<% if Flipper.enabled?(:shop_backlogged) %>
  <div class="backlog-banner">
    ‚ö†Ô∏è There is many shop orders and we are currently a bit backlogged! Please be patient with us fraud dept + fulfilment team is volunteers who have a life, school and other things as well :3
  </div>
<% end %>

<div class="fraud-grid">
  <div class="card fraud-card fraud-card--wide">
    <h2>Queue Status</h2>
    <div class="fraud-stats">
      <div class="fraud-stat fraud-stat--warning">
        <span class="fraud-stat__value"><%= @pending_count %></span>
        <span class="fraud-stat__label">Pending</span>
      </div>
      <div class="fraud-stat fraud-stat--warning">
        <span class="fraud-stat__value"><%= @pending_count %></span>
        <span class="fraud-stat__label">Total Backlog</span>
      </div>
    </div>
    <% if @avg_response_hours %>
      <p class="fraud-note">Avg response time (30d): <strong><%= @avg_response_hours %>h</strong></p>
    <% end %>
  </div>

  <div class="card fraud-card">
    <h2>Wait Times</h2>
    <div class="fraud-stats">
      <div class="fraud-stat fraud-stat--danger">
        <span class="fraud-stat__value"><%= @oldest_waiting ? distance_of_time_in_words_to_now(@oldest_waiting) : "‚Äî" %></span>
        <span class="fraud-stat__label">Oldest Waiting</span>
      </div>
      <div class="fraud-stat fraud-stat--success">
        <span class="fraud-stat__value"><%= @newest_waiting ? distance_of_time_in_words_to_now(@newest_waiting) : "‚Äî" %></span>
        <span class="fraud-stat__label">Newest Waiting</span>
      </div>
      <div class="fraud-stat fraud-stat--info">
        <span class="fraud-stat__value"><%= @avg_wait ? "#{@avg_wait}h" : "‚Äî" %></span>
        <span class="fraud-stat__label">Avg Wait</span>
      </div>
    </div>
  </div>

  <div class="card fraud-card">
    <h2>By Item Type</h2>
    <table class="fraud-table">
      <thead><tr><th>Type</th><th>Count</th></tr></thead>
      <tbody>
        <% @by_item_type.sort_by { |_, c| -c }.each do |type, count| %>
          <tr>
            <td><%= type.demodulize.titleize %></td>
            <td><strong><%= count %></strong></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<div class="fraud-grid">
  <div class="card fraud-card">
    <h2>Pending Orders</h2>
    <% if @pending_orders.any? %>
      <table class="fraud-table">
        <thead>
          <tr><th>#</th><th>Created</th></tr>
        </thead>
        <tbody>
          <% @pending_orders.each do |order| %>
            <tr>
              <td><%= order.id %></td>
              <td><%= order.created_at ? "#{time_ago_in_words(order.created_at)} ago" : "‚Äî" %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="fraud-note">No pending orders üéâ</p>
    <% end %>
  </div>
</div>

<style>
.fraud-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}
.fraud-card { display: flex; flex-direction: column; gap: 0.75rem; }
.fraud-card--wide { grid-column: span 2; }
@media (max-width: 800px) { .fraud-card--wide { grid-column: span 1; } }
.fraud-card h2 { margin: 0 0 0.25rem; font-size: 1rem; }
.fraud-stats { display: flex; flex-wrap: wrap; gap: 1rem; }
.fraud-stat { display: flex; flex-direction: column; align-items: center; min-width: 80px; padding: 0.5rem; }
.fraud-stat__value { font-size: 1.5rem; font-weight: 700; line-height: 1; }
.fraud-stat__label { font-size: 0.7rem; color: var(--color-text-muted); text-align: center; }
.fraud-stat--warning .fraud-stat__value { color: #f59e0b; }
.fraud-stat--success .fraud-stat__value { color: #10b981; }
.fraud-stat--danger .fraud-stat__value { color: #ef4444; }
.fraud-stat--info .fraud-stat__value { color: #3b82f6; }
.fraud-table { width: 100%; border-collapse: collapse; font-size: 0.875rem; }
.fraud-table th, .fraud-table td { padding: 0.375rem 0.5rem; text-align: left; border-bottom: 1px solid var(--color-tan-400); }
.fraud-table th { font-weight: 600 }
.fraud-table td:last-child { text-align: right; }
.fraud-note { margin: 0; font-size: 0.8rem; color: var(--color-text-muted); }
.backlog-banner {
  background: #fef3c7;
  border: 1px solid #f59e0b;
  color: #92400e;
  padding: 0.75rem 1rem;
  border-radius: 8px;
  margin-bottom: 1.5rem;
  font-weight: 500;
}
</style>
