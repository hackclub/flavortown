<div class="shop" data-controller="shop">
  <%= render HeadingComponent.new(title: "Shop", tone: :brown) %>
  <% if @shop_open %>
    <% if current_user&.admin? %>
      <div class="admin-banner">
        <div class="admin-banner__content">
          <span class="admin-banner__count"><%= @shop_items.count %> items</span>
          <a href="/admin/manage-shop" class="admin-banner__link">Edit items â†’</a>
        </div>
      </div>
    <% end %>
    <div class="shop__buttons">
      <%= render ButtonComponent.new(
            text: "View My Orders",
            href: "/shop/my_orders",
            color: :brown,
            variant: :borderless
      ) %>
      <%= render DropdownComponent.new(
        label: "Region",
        options: @region_options,
        selected_option: Shop::Regionalizable::REGIONS.dig(@user_region, :name),
        longest_option_string: "Rest of World",
        color: :brown
      ) %>
    </div>
    <% if @featured_item %>
      <div class="shop__banner">
        <div class="shop__banner-headings">
          <h3 class="shop__banner-title">Get Started</h3>
          <h3 class="shop__banner-price"><%= number_to_currency(@featured_item.price_for_region(@user_region), precision: 0).gsub('$', 'ðŸª') %></h3>
        </div>
        <div class="shop__banner-showcase">
          <div class="shop__banner-item-desc">
            <h4><%= @featured_item.name %></h4>
            <h5><%= @featured_item.description %></h5>
            <h6>~<%= @featured_item.hours_estimated %> hours</h6>

            <%= render ButtonComponent.new(
              text: "Order #{@featured_item.name}",
              href: "/shop/order?shop_item_id=#{@featured_item.id}",
              color: :brown,
              variant: :borderless
            ) %>
          </div>
          <% if @featured_item.image.present? %>
            <%= image_tag @featured_item.image.variant(:carousel_lg), loading: "lazy", decoding: "async", alt: "#{@featured_item.name} image" %>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="shop__banner shop__banner--empty">
        <div class="shop__banner-headings">
          <h3 class="shop__banner-title">Free Stickers Not Available</h3>
          <h5 class="shop__banner-subtitle">Check back soon!</h5>
        </div>
      </div>
    <% end %>
    <div class="shop__nav">
      <div class="shop__searchbar">
        <%= form_with url: shop_path, method: :get, local: true do |f| %>
          <%= render InputComponent.new(
            label: nil,
            icon: "icons/search.svg",
            placeholder: "Search item",
            form: f,
            attribute: :q,
            color: :yellow,
            input_html: {
              value: params[:q],
              data: { action: "input->shop#search" }
            }
          ) %>
         <% end %>
      </div>
      <div class="shop__filters">
        <%= render DropdownComponent.new(
          label: "Category",
          options: ["All", "Grants", "HQ", "Digital", "Locally Fulfilled", "Made by Hack Clubbers"],
          selected_option: "All",
          longest_option_string: "Made by Hack Clubbers",
          color: :blue
        ) %>
        <%= render DropdownComponent.new(
          label: "Price Range",
          options: [
            { label: "None", value: "none" },
            { label: "ðŸª0 - ðŸª1000", value: "0-1000" },
            { label: "ðŸª1000 - ðŸª5000", value: "1000-5000" },
            { label: ">ðŸª5000", value: "5000+" }
          ],
          selected_option: "None",
          longest_option_string: "ðŸª1000 - ðŸª5000",
          color: :pink
        ) %>
        <%= render DropdownComponent.new(
          label: "Sort by",
          options: ["Prices", "Alphabetical"],
          selected_option: "Prices",
          longest_option_string: "Alphabetical",
          color: :green
        ) %>
        <button id="sort-btn">
          <span>
            <%= inline_svg_tag "icons/sort.svg", title: "Sort Icon" %>
          </span>
          <%= inline_svg_tag "icons/sort-btn-icon.svg", title: "Sort Arrow" %>
        </button>
      </div>
    </div>
    <div class="shop__items">
      <% @shop_items.each do |item| %>
        <% if item.image.present? && item.enabled_in_region?(@user_region) %>
          <%= render ShopItemCardComponent.new(
            item_id: item.id,
            name: item.name,
            description: item.description,
            hours: item.hours_estimated,
            price: item.ticket_cost,
            image_url: item.image.variant(:carousel_lg),
            item_type: item.type,
            balance: @user_balance,
            enabled_regions: Shop::Regionalizable::REGION_CODES.select { |code| item.enabled_in_region?(code) },
            regional_price: item.price_for_region(@user_region)
          ) %>
        <% end %>
      <% end %>
    </div>
  <% else %>
    <h2>The shop is not opened yet!</h2>
  <% end %>
</div>
