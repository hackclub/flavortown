<div class="shop" data-controller="shop" data-shop-user-region-value="<%= @user_region %>">
  <%= render HeadingComponent.new(title: "Shop", tone: :brown) %>
  <% if @shop_open %>
    <% if current_user&.admin? %>
      <div class="admin-banner">
        <div class="admin-banner__content">
          <span class="admin-banner__count"><%= @shop_items.count %> items</span>
          <a href="/admin/manage-shop" class="admin-banner__link">Edit items â†’</a>
        </div>
      </div>
    <% end %>
    <div class="shop__buttons">
      <%= render ButtonComponent.new(
            text: "View My Orders",
            href: "/shop/my_orders",
            color: :brown,
            variant: :borderless
      ) %>
      <%= render DropdownComponent.new(
        label: "Region",
        options: @region_options,
        selected_option: Shop::Regionalizable::REGIONS.dig(@user_region, :name),
        longest_option_string: "Rest of World",
        color: :brown
      ) %>
    </div>
    <%= render partial: "shop/banner", locals: { featured_item: @featured_item, user_region: @user_region } %>
    <div class="shop__nav">
      <div class="shop__searchbar">
        <%= form_with url: shop_path, method: :get, local: true do |f| %>
          <%= render InputComponent.new(
            label: nil,
            icon: "icons/search.svg",
            placeholder: "Search item",
            form: f,
            attribute: :q,
            color: :yellow,
            input_html: {
              value: params[:q],
              data: { action: "input->shop#search" }
            }
          ) %>
         <% end %>
      </div>
      <div class="shop__filters">
        <%= render DropdownComponent.new(
          label: "Category",
          options: ["All", "Grants", "HQ", "Digital", "Locally Fulfilled", "Made by Hack Clubbers"],
          selected_option: "All",
          longest_option_string: "Made by Hack Clubbers",
          color: :blue
        ) %>
        <%= render DropdownComponent.new(
          label: "Price Range",
          options: [
            { label: "None", value: "none" },
            { label: "ðŸª0 - ðŸª1000", value: "0-1000" },
            { label: "ðŸª1000 - ðŸª5000", value: "1000-5000" },
            { label: ">ðŸª5000", value: "5000+" }
          ],
          selected_option: "None",
          longest_option_string: "ðŸª1000 - ðŸª5000",
          color: :pink
        ) %>
        <%= render DropdownComponent.new(
          label: "Sort by",
          options: ["Prices", "Alphabetical"],
          selected_option: "Prices",
          longest_option_string: "Alphabetical",
          color: :green
        ) %>
        <button id="sort-btn">
          <span>
            <%= inline_svg_tag "icons/sort.svg", title: "Sort Icon" %>
          </span>
          <%= inline_svg_tag "icons/sort-btn-icon.svg", title: "Sort Arrow" %>
        </button>
      </div>
    </div>
    <%= turbo_frame_tag "shop_items" do %>
      <div class="shop__items">
        <% @shop_items.each do |item| %>
          <% if item.image.present? && item.enabled_in_region?(@user_region) %>
            <%= render ShopItemCardComponent.new(
              item_id: item.id,
              name: item.name,
              description: item.description,
              hours: item.hours_estimated,
              price: item.ticket_cost,
              image_url: item.image.variant(:carousel_lg),
              item_type: item.type,
              balance: @user_balance,
              enabled_regions: Shop::Regionalizable::REGION_CODES.select { |code| item.enabled_in_region?(code) },
              regional_price: item.price_for_region(@user_region)
            ) %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <h2>The shop is not opened yet!</h2>
  <% end %>
</div>
