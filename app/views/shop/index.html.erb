<div class="shop" data-controller="shop">
  <%= render HeadingComponent.new(title: "Shop", tone: :brown) %>
  <% if @shop_open %>
    <% if current_user&.admin? %>
      <div class="admin-banner">
        <div class="admin-banner__content">
          <span class="admin-banner__count"><%= @shop_items.count %> items</span>
          <a href="/admin/shop_items" class="admin-banner__link">Edit items â†’</a>
        </div>
      </div>
    <% end %>
    <div class="shop__buttons">
      <%= render ButtonComponent.new(
            text: "View My Orders",
            href: "/shop/my_orders",
            color: :brown,
            variant: :borderless
      ) %>
      <%= render DropdownComponent.new(
        label: "Region",
        options: ["United States", "Canada", "Europe", "United Kingdom", "Australia", "India", "Other"],
        selected_option: "United States",
        color: :brown
      ) %>
    </div>
    <% if @weekly_item %>
      <div class="shop__banner">
        <div class="shop__banner-headings">
          <h3 class="shop__banner-title">Weekly items</h3>
          <h3 class="shop__banner-price"><%= number_to_currency(@weekly_item.ticket_cost).gsub('$', 'ðŸª') %></h3>
        </div>
        <div class="shop__banner-showcase">
          <div class="shop__banner-item-desc">
            <h4><%= @weekly_item.name %></h4>
            <h5><%= @weekly_item.description %></h5>
            <h6>~<%= @weekly_item.hours_estimated %> hours</h6>

            <%= render ButtonComponent.new(
              text: "Buy #{@weekly_item.name}",
              href: "/shop/my_orders",
              color: :brown,
              variant: :borderless
            ) %>
          </div>
          <% if @weekly_item.image.present? %>
            <%= image_tag @weekly_item.image.variant(:carousel_lg), loading: "lazy", decoding: "async", alt: "#{@weekly_item.name} image" %>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="shop__banner shop__banner--empty">
        <div class="shop__banner-headings">
          <h3 class="shop__banner-title">No Weekly Item</h3>
          <h5 class="shop__banner-subtitle">Check back next week for an exciting weekly offer!</h5>
        </div>
      </div>
    <% end %>
    <div class="shop__nav">
      <div class="shop__searchbar">
        <%= form_with url: shop_path, method: :get, local: true do |f| %>
          <%= render InputComponent.new(
            label: nil,
            icon: "icons/search.svg",
            placeholder: "Search item",
            form: f, # Not needed for standalone inputs
            attribute: :q,
            color: :yellow
          ) %>
         <% end %>
      </div>
      <div class="shop__filters">
        <%= render DropdownComponent.new(
          label: "Category",
          options: ["Grants", "Warehouse", "Third Party"],
          selected_option: "Grants",
          color: :blue
        ) %>
        <%= render DropdownComponent.new(
          label: "Price Range",
          options: ["ðŸª0 - ðŸª1000", "ðŸª1000 - ðŸª5000", ">ðŸª5000"],
          selected_option: "ðŸª0 - ðŸª1000",
          color: :pink
        ) %>
        <%= render DropdownComponent.new(
          label: "Sort by",
          options: ["Prices", "Alphabetical"],
          selected_option: "Prices",
          color: :green
        ) %>
        <button id="sort-btn">
          <span>
            <%= inline_svg_tag "icons/sort.svg", title: "Sort Icon" %>
          </span>
          <%= inline_svg_tag "icons/sort-btn-icon.svg", title: "Sort Arrow" %>
        </button>
      </div>
    </div>
    <div class="shop__items">
      <% @shop_items.each do |item| %>
        <% if item.image.present? %>
          <%= render ShopItemCardComponent.new(
            name: item.name,
            description: item.description,
            hours: item.hours_estimated,
            price: item.ticket_cost,
            image_url: item.image.variant(:carousel_lg)
          ) %>
        <% end %>
      <% end %>
    </div>
  <% else %>
    <h2>The shop is not opened yet!</h2>
  <% end %>
</div>
