<% content_for :title, "Add Devlog" %>

<div class="projects-new">
  <div class="projects-new__container">
    <%= render HeadingComponent.new(title: "Add Devlog", tone: :brown) %>

    <div class="projects-new__time-preview">
      <p>This devlog will log <strong><%= @preview_time %></strong> of work.</p>
    </div>

    <%= form_with model: @devlog,
                  url: project_devlogs_new_path(@project),
                  html: { multipart: true },
                  class: "projects-new__form",
                  local: true do |f| %>
      <div class="projects-new__card">
        <div class="projects-new__field">
          <%= render InputComponent.new(
                label: "Devlog Text",
                placeholder: "Write a few sentences about what you worked on…",
                form: f,
                attribute: :body,
                color: :red,
                as: :text_area,
                input_html: { rows: 6 }
              ) %>
        </div>

        <% if Flipper.enabled?(:scrapbook_devlogs, current_user) %>
          <div class="projects-new__field">
            <%= render InputComponent.new(
                  label: "Scrapbook URL (optional)",
                  placeholder: "https://hackclub.slack.com/...",
                  form: f,
                  attribute: :scrapbook_url,
                  color: :blue,
                  subtitle: "⚠️ If provided, this will replace the devlog text and attachments with the Slack message content."
                ) %>
          </div>
        <% end %>

        <div class="projects-new__field">
          <%= render FileUploadComponent.new(
                label: "Attachment",
                form: f,
                attribute: :attachments,
                color: :green,
                subtitle: "Supports images, video, and GIF. Max 50 MB.",
                accept: Post::Devlog::ACCEPTED_CONTENT_TYPES.join(","),
                multiple: true,
                max_count: 8,
                max_size: 50.megabytes
              ) %>
        </div>
      </div>

      <div class="projects-new__actions">
        <% if @project.hackatime_keys.present? %>
          <%= render ButtonComponent.new(text: "Create Devlog", color: :brown, type: :submit) %>
        <% else %>
          <%= render ButtonComponent.new(text: "Create Devlog", color: :brown, type: :submit, disabled: true) %>
          <p class="projects-new__error">You must link at least one Hackatime project before posting a devlog. <%= link_to "Edit project settings", edit_project_path(@project) %></p>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
