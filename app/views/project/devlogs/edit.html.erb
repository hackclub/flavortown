<% content_for :title, "Edit Devlog" %>

<div class="projects-new">
  <div class="projects-new__container">
    <%= render HeadingComponent.new(title: "Edit Devlog", tone: :brown) %>

    <%= form_with model: @devlog,
                  url: project_devlog_path(@project, @devlog),
                  method: :patch,
                  class: "projects-new__form",
                  local: true do |f| %>
      <div class="projects-new__card">
        <div class="projects-new__field">
          <%= render InputComponent.new(
                label: "Devlog Text",
                placeholder: "Write a few sentences about what you worked onâ€¦",
                form: f,
                attribute: :body,
                color: :red,
                as: :text_area,
                input_html: { rows: 6 }
              ) %>
        </div>

        <% if @devlog.attachments.attached? %>
          <div class="projects-new__field">
            <p class="input__label" style="color: var(--color-brown-900); font-weight: 600;">Current Attachments</p>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap; padding: 1rem; background: var(--color-bg); border-radius: 8px;">
              <% @devlog.attachments.each do |attachment| %>
                <% if attachment.content_type.start_with?("image/") %>
                  <%= image_tag url_for(attachment.variant(:thumb)), style: "max-width: 100px; max-height: 100px; border-radius: 8px; border: 2px solid var(--color-brown-300);" %>
                <% else %>
                  <div style="padding: 1rem; background: var(--color-brown-100); border-radius: 8px; color: var(--color-brown-900);">
                    <%= attachment.filename %>
                  </div>
                <% end %>
              <% end %>
            </div>
            <p class="input__subtitle" style="color: var(--color-brown-700); margin-top: 0.5rem;">Attachments cannot be changed after creation.</p>
          </div>
        <% end %>
      </div>

      <div class="projects-new__actions">
        <%= render ButtonComponent.new(text: "Cancel", href: project_path(@project), color: :red, variant: :borderless) %>
        <%= render ButtonComponent.new(text: "Save Changes", color: :brown, type: :submit, disable_with: "Saving...") %>
      </div>
    <% end %>

    <% if @devlog.versions.any? %>
      <div class="projects-new__card" style="margin-top: 2rem;">
        <h3>Version History</h3>
        <p><%= link_to "View #{@devlog.versions.count} previous version(s)", versions_project_devlog_path(@project, @devlog) %></p>
      </div>
    <% end %>
  </div>
</div>
