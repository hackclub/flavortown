<div style="margin-bottom: 2em; display: flex; gap: 1em; align-items: center;">
  <h1 style="margin: 0;">
    <%= @view == 'fulfillment' ? 'Pending Fulfillment' : 'Shop Orders' %>
  </h1>

  <% if current_user.fulfillment_person? && !current_user.admin? && current_user.has_regions? %>
    <span style="background: #e0f2fe; color: #0369a1; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500;">
      üìç <%= current_user.regions_display %>
    </span>
  <% end %>

  <div style="margin-left: auto; display: flex; gap: 0.5em;">
  <% if current_user.admin? || current_user.fraud_dept? %>
  <%= link_to "Shop Orders", admin_shop_orders_path(view: 'shop_orders'),
        class: "btn-#{@view == 'shop_orders' ? 'primary' : 'secondary'} slim" %>
<% end %>
    <% if current_user.admin? || current_user.fulfillment_person? %>
      <%= link_to "Pending Fulfillment", admin_shop_orders_path(view: 'fulfillment'),
          class: "btn-#{@view == 'fulfillment' ? 'primary' : 'secondary'} slim" %>
    <% end %>
  </div>
</div>

<div style="display: flex; gap: 2em; align-items: flex-start;">
  <div style="flex: 1;">
    <%= render partial: "stats", locals: { counts: @c, average_fulfillment_time: @f } %>
  </div>
  <div style="flex-shrink: 0;">
    <%= render partial: "action_leaderboard" %>
  </div>
</div>

<div style="margin-bottom: 2em;">
  <% if params[:goob] == "true" %>
    <%= link_to "Ungroup", admin_shop_orders_path(params.permit(:user_search, :shop_item_id, :status, :date_from, :date_to, :sort, :view).except(:goob)), class: "btn-secondary slim" %>
  <% else %>
    <%= link_to "Group by User", admin_shop_orders_path(params.permit(:user_search, :shop_item_id, :status, :date_from, :date_to, :sort, :view).merge(goob: true)), class: "btn-primary slim" %>
  <% end %>
</div>

<%= render partial: "filters" %>

<% if @grouped_orders %>
  <%= render partial: "grouped_table", locals: { grouped_orders: @grouped_orders } %>
<% elsif @shop_orders %>
  <%= render partial: "table", locals: { orders: @shop_orders } %>
<% end %>

<div style="margin-top: 2em;">
  <%= link_to "‚Üê Back", admin_root_path, class: "btn-secondary" %>
</div>

<style>
.badge {
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.875rem;
  font-weight: 500;
  text-transform: capitalize;
  display: inline-block;
}

.badge-pending {
  background-color: #fbbf24;
  color: #78350f;
}

.badge-awaiting_periodical_fulfillment {
  background-color: #60a5fa;
  color: #1e3a8a;
}

.badge-fulfilled {
  background-color: #10b981;
  color: white;
}

.badge-rejected {
  background-color: #ef4444;
  color: white;
}

.badge-on_hold {
  background-color: #6b7280;
  color: white;
}

.badge-refunded {
  background-color: #a855f7;
  color: white;
}

.form-control {
  width: 100%;
  padding: 0.5em;
  border-radius: 6px;
  border: 1px solid #d1d5db;
  background: white;
}

/* Searchable Select */
.searchable-select-dropdown {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  max-height: 240px;
  overflow-y: auto;
  background: var(--color-tan-300, #faf7f2);
  border: 1px solid var(--color-brown-500, #8b7355);
  border-radius: 0.5rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 100;
  margin-top: 0.25rem;
}

.searchable-select-option {
  padding: 0.5rem 0.75rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: background 0.1s;
}

.searchable-select-option:hover {
  background: var(--color-tan-400, #f0ebe3);
}

.searchable-select-avatar {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  object-fit: cover;
  flex-shrink: 0;
}
</style>
