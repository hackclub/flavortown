<div class="card" style="margin-bottom: 2em;">
  <h2>Statistics</h2>
  <p style="margin-bottom: 0.75em; color: #666; font-size: 0.9em;">Click a status to filter orders:</p>
  <div style="display: flex; flex-wrap: wrap; gap: 0.5em; align-items: center; margin-bottom: 1.5em;">
    <%= link_to admin_shop_orders_path(params.permit(:user_search, :shop_item_id, :date_from, :date_to, :sort, :view, :goob, :region).merge(status: 'pending')),
        class: "badge badge-pending status-filter-link #{'active' if params[:status] == 'pending'}",
        style: "text-decoration: none;" do %>
      Pending: <%= counts[:pending] %>
    <% end %>

    <%= link_to admin_shop_orders_path(params.permit(:user_search, :shop_item_id, :date_from, :date_to, :sort, :view, :goob, :region).merge(status: 'awaiting_verification')),
        class: "badge badge-awaiting_verification status-filter-link #{'active' if params[:status] == 'awaiting_verification'}",
        style: "text-decoration: none;" do %>
      Awaiting Verification: <%= counts[:awaiting_verification] %>
    <% end %>

    <%= link_to admin_shop_orders_path(params.permit(:user_search, :shop_item_id, :date_from, :date_to, :sort, :view, :goob, :region).merge(status: 'awaiting_periodical_fulfillment')),
        class: "badge badge-awaiting_periodical_fulfillment status-filter-link #{'active' if params[:status] == 'awaiting_periodical_fulfillment'}",
        style: "text-decoration: none;" do %>
      Awaiting Fulfillment: <%= counts[:awaiting_fulfillment] %>
    <% end %>

    <%= link_to admin_shop_orders_path(params.permit(:user_search, :shop_item_id, :date_from, :date_to, :sort, :view, :goob, :region).merge(status: 'on_hold')),
        class: "badge badge-on_hold status-filter-link #{'active' if params[:status] == 'on_hold'}",
        style: "text-decoration: none;" do %>
      On Hold: <%= counts[:on_hold] %>
    <% end %>

    <%= link_to admin_shop_orders_path(params.permit(:user_search, :shop_item_id, :date_from, :date_to, :sort, :view, :goob, :region).merge(status: 'fulfilled')),
        class: "badge badge-fulfilled status-filter-link #{'active' if params[:status] == 'fulfilled'}",
        style: "text-decoration: none;" do %>
      Fulfilled: <%= counts[:fulfilled] %>
    <% end %>

    <%= link_to admin_shop_orders_path(params.permit(:user_search, :shop_item_id, :date_from, :date_to, :sort, :view, :goob, :region).merge(status: 'rejected')),
        class: "badge badge-rejected status-filter-link #{'active' if params[:status] == 'rejected'}",
        style: "text-decoration: none;" do %>
      Rejected: <%= counts[:rejected] %>
    <% end %>

    <% if params[:status].present? %>
      <%= link_to admin_shop_orders_path(params.permit(:user_search, :shop_item_id, :date_from, :date_to, :sort, :view, :goob, :region).except(:status)),
          class: "badge",
          style: "text-decoration: none; background: #e5e7eb; color: #374151;" do %>
        âœ• Clear filter
      <% end %>
    <% end %>
  </div>

  <% if average_fulfillment_time %>
    <div>
      <strong>Average time from order to fulfilled:</strong>
      <span style="font-family: monospace; font-weight: bold; <%= average_fulfillment_time > 172800 ? 'color: #ef4444;' : '' %>">
        <%= distance_of_time_in_words(average_fulfillment_time) %>
      </span>
    </div>
  <% end %>
</div>

<style>
  .status-filter-link {
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }

  .status-filter-link:hover {
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  .status-filter-link.active {
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.3);
    transform: scale(1.05);
  }
</style>
