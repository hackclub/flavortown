<h1 align="center">Votes on <%= @project.title %> (#<%= @project.id %>)</h1>

<div style="margin: 1.5em 0;">
  <%= link_to "← Back to Project", admin_project_path(@project), class: "btn-secondary" %>
</div>

<div class="card voting-card voting-card--full">
  <% if @votes.any? %>
    <table class="voting-table voting-table--wide">
      <thead>
        <tr>
          <th>Time</th>
          <th>Voter</th>
          <th>Orig.</th>
          <th>Tech.</th>
          <th>Usab.</th>
          <th>Story.</th>
          <th>Time</th>
          <th>Demo</th>
          <th>Repo</th>
          <th>Discarded</th>
          <th>Reason</th>
        </tr>
      </thead>
      <tbody>
        <% @votes.each do |vote| %>
          <tr class="<%= 'suspicious-vote' if vote.suspicious %>">
            <td><%= time_ago_in_words(vote.created_at) %> ago</td>
            <td>
              <% if vote.user %>
                <%= link_to vote.user.display_name || "User ##{vote.user.id}", admin_user_path(vote.user) %>
              <% else %>
                <span class="text-muted">Unknown</span>
              <% end %>
            </td>
            <td class="score"><%= vote.originality_score || "—" %></td>
            <td class="score"><%= vote.technical_score || "—" %></td>
            <td class="score"><%= vote.usability_score || "—" %></td>
            <td class="score"><%= vote.storytelling_score || "—" %></td>
            <td><%= vote.time_taken_to_vote ? "#{vote.time_taken_to_vote}s" : "—" %></td>
            <td><%= vote.demo_url_clicked ? "✓" : "—" %></td>
            <td><%= vote.repo_url_clicked ? "✓" : "—" %></td>
            <td>
              <% if vote.suspicious %>
                <span class="text-danger">⚠ Yes</span>
              <% else %>
                <span class="text-muted">No</span>
              <% end %>
            </td>
            <td>
              <% if vote.reason.present? %>
                <details>
                  <summary>View</summary>
                  <div style="margin-top: 0.5rem; white-space: pre-wrap; max-width: 300px;"><%= vote.reason %></div>
                </details>
              <% else %>
                <span class="text-muted">—</span>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <% if @pagy.pages > 1 %>
      <div class="pagination" style="margin-top: 1rem;">
        <%== @pagy.series_nav %>
      </div>
    <% end %>
  <% else %>
    <p>No votes received yet.</p>
  <% end %>
</div>
