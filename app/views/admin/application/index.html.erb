<h1 style="<%= 'border: 3px solid green; padding: 10px;' if Flipper.enabled?(:admin_green, current_user) %>">Hello there <%= current_user.highest_role %>!</h1>

<h2>tasks</h2>
<div class="button-grid">
  <% if policy(:admin).manage_users? %>
    <%= link_to "Users", "/admin/users", class: "btn-primary" %>
  <% end %>

  <% button_class = Flipper.enabled?(:admin_dark_brown_buttons, current_user) ? "btn-primary-dark" : "btn-primary" %>
  <% if policy(:admin).manage_projects? %>
    <%= link_to "Projects", admin_projects_path, class: "btn-primary" %>
  <% end %>
  <% if policy(:admin).manage_shop? %>
    <%= link_to "Manage shop", admin_manage_shop_path, class: button_class %>
  <% end %>
  <% if policy(:admin).access_audit_logs? %>
    <%= link_to "Audit Logs", admin_audit_logs_path, class: button_class %>
  <% end %>
  <% if policy(:admin).access_reports? %>
    <% pending_reports = Project::Report.pending.count %>
    <%= link_to "/admin/reports?status=pending", class: button_class do %>
      Reports
      <% if pending_reports > 0 %>
        <span style="background-color: #ef4444; color: white; border-radius: 9999px; padding: 0px 6px; font-size: 0.9em; min-width: 20px; text-align: center;">
          <%= pending_reports %>
        </span>
      <% end %>
    <% end %>
  <% end %>
  <% if policy(:admin).access_shop_orders? %>
    <% pending_count = ShopOrder.where(aasm_state: 'pending').count %>
    <% total_shop_count = pending_count %>
    <%= link_to "/admin/shop_orders?status=pending&view=shop_orders", class: "btn-primary" do %>
      Shop Orders
      <% if total_shop_count > 0 %>
        <%
          bg_color = if total_shop_count < 50
                       "#10b981"
                     elsif total_shop_count <= 100
                       "#fbbf24"
                     else
                       "#ef4444"
                     end
          text_color = total_shop_count >= 50 && total_shop_count <= 100 ? "#78350f" : "white"
        %>
        <span style="background-color: <%= bg_color %>; color: <%= text_color %>; border-radius: 9999px; padding: 0px 6px; font-size: 0.9em; min-width: 20px; text-align: center;">
          <%= total_shop_count %>
        </span>
      <% end %>
    <% end %>
  <% end %>
  <% if current_user.admin? || current_user.fulfillment_person? %>
    <% awaiting_count = ShopOrder.where(aasm_state: 'awaiting_periodical_fulfillment').count %>
    <%= link_to "/admin/shop_orders?status=awaiting_periodical_fulfillment&view=fulfillment", class: "btn-primary" do %>
      Pending Fulfillment
      <% if awaiting_count > 0 %>
        <%
          bg_color = if awaiting_count < 50
                       "#10b981"
                     elsif awaiting_count <= 100
                       "#fbbf24"
                     else
                       "#ef4444"
                     end
          text_color = awaiting_count >= 50 && awaiting_count <= 100 ? "#78350f" : "white"
        %>
        <span style="background-color: <%= bg_color %>; color: <%= text_color %>; border-radius: 9999px; padding: 0px 6px; font-size: 0.9em; min-width: 20px; text-align: center;">
          <%= awaiting_count %>
        </span>
      <% end %>
    <% end %>
  <% end %>
</div>

<h2>dashboards</h2>
<div class="button-grid">
  <% button_class = Flipper.enabled?(:admin_dark_brown_buttons, current_user) ? "btn-primary-dark" : "btn-primary" %>
  <% if policy(:admin).access_blazer? %>
    <%= link_to "Blazer", "/admin/blazer", class: button_class %>
  <% end %>

  <% if policy(:admin).access_flipper? %>
    <%= link_to "Flipper", "/admin/flipper", class: button_class %>
  <% end %>
  <% if policy(:admin).manage_user_roles? %>
  <%= link_to "Manage users w/ perms", "/admin/user-perms", class: button_class %>
<% end %>
<% if policy(:admin).access_jobs? %>
<%= link_to "Job queue", "/admin/jobs", class: button_class %>
<% end %>
  <% if policy(:admin).access_payouts_dashboard? %>
  <%= link_to "Payouts Dashboard", "/admin/payouts_dashboard", class: button_class %>
<% end %>
<% if policy(:admin).access_fulfillment_dashboard? %>
  <%= link_to "Fulfillment Dashboard", admin_fulfillment_dashboard_index_path, class: button_class %>
<% end %>
  <%= link_to "Help bot", "slack://app?team=T0266FRGM&id=A09NP19R7FX&tab=home", class: "btn-primary" %>
  <%= link_to "Ship Cert Dashboard", "https://sw.eryxks.dev/dash", class: "btn-primary", target: "_blank" %>
</div>
