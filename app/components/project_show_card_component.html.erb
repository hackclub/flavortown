<%= render "shared/inspector", record: project %>
<article class="project-show-card">
  <div class="project-show-card__banner project-card__banner">
    <div class="project-card__banner-frame">
      <% if banner_variant.present? %>
        <%= image_tag project.banner.variant(:card), class: "project-card__banner-image", alt: "#{project.title} banner" %>
        <% if owner? && (project.draft? || project.can_ship_again?) %>
            <%= render ButtonComponent.new(
                text: project.draft? ? "Ship" : "Ship Again",
                color: :green,
                icon: "icons/ship.svg",
                href: ship_project_path(project),
                class: "project-show-card__ship-btn"
            ) %>
        <% end %>
        <% if helpers.current_user.present? && helpers.policy(:admin).manage_projects? %>
          <%= render ButtonComponent.new(
              text: project.fire? ? "Unmark ðŸ”¥" : "Mark as ðŸ”¥",
              color: :green,
              icon: "icons/fire.svg",
              class: "project-show-card__fire-btn",
              data: {
                controller: "project-fire",
                action: "click->project-fire#toggle",
                project_fire_project_id_value: project.id,
                project_fire_is_fire_value: project.fire?
              }
          ) %>
        <% end %>
      <% else %>
        <div class="project-card__banner-frame project-card__banner-frame--placeholder">
          <div class="project-card__banner-placeholder">
            <div class="project-card__banner-placeholder-text">No banner uploaded</div>
            <% if owner? && (project.draft? || project.can_ship_again?) %>
              <%= render ButtonComponent.new(
                text: project.draft? ? "Ship" : "Ship Again",
                color: :green,
                icon: "icons/ship.svg",
                href: ship_project_path(project),
                class: "project-show-card__ship-btn",
                disabled: true
              ) %>
            <% end %>
            <% if helpers.current_user.present? && helpers.policy(:admin).manage_projects? %>
              <%= render ButtonComponent.new(
                  text: project.fire? ? "Unmark ðŸ”¥" : "Mark as ðŸ”¥",
                  color: :green,
                  icon: "icons/fire.svg",
                  class: "project-show-card__fire-btn",
                  data: {
                    controller: "project-fire",
                    action: "click->project-fire#toggle",
                    project_fire_project_id_value: project.id,
                    project_fire_is_fire_value: project.fire?
                  }
              ) %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="project-show-card__content project-card__content">
    <header class="project-show-card__header">
      <div class="project-show-card__titlebar">
        <h1 class="project-show-card__title project-card__title">
          <span class="project-show-card__title-text"><%= project.title %></span>
        </h1>

        <% if helpers.policy(project).edit? || helpers.policy(project).destroy? %>
          <div class="projects-show__admin-actions">
            <% if helpers.policy(project).edit? %>
              <%= render ButtonComponent.new(
                    href: helpers.edit_project_path(project),
                    color: :brown,
                    variant: :borderless,
                    icon: "icons/edit.svg",
                    class: "projects-show__icon-btn",
                    aria: { label: "Edit project" }
                  ) %>
            <% end %>
            <% if helpers.policy(project).destroy? %>
              <%= button_to helpers.project_path(project),
                    method: :delete,
                    class: "btn btn--brown btn--borderless projects-show__icon-btn",
                    data: { confirm: "Delete this project?" },
                    aria: { label: "Delete project" } do %>
                <%= helpers.inline_svg_tag "icons/trash-bin.svg" %>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="project-show-card__byline">
        <%= byline_text %>
      </div>

      <div class="project-show-card__stats">
        <div class="project-show-card__stats">
          <div class="project-show-card__stat">
            <%= helpers.inline_svg_tag("icons/paper.svg") %>
            <span><%= project.devlogs_count %> devlogs</span>
          </div>
          <div class="project-show-card__stat">
            <%= helpers.inline_svg_tag("icons/time.svg") %>
            <span><%= "#{project.time.hours}hr #{project.time.minutes}min" %></span>
          </div>
          <% if owner? && ship_status.present? %>
            <div class="project-show-card__stat">
              <% if has_feedback? %>
                <button type="button" data-controller="modal" data-action="click->modal#open" data-modal-target-value="ship-feedback-modal-<%= project.id %>" style="background-color: <%= ship_status_color %>; color: white; border-radius: 9999px; padding: 2px 10px; font-size: 0.85em; font-weight: 600; border: none; cursor: pointer; display: inline-flex; align-items: center; gap: 4px;" title="Click to view feedback">
                  <%= ship_status_label %>
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></svg>
                </button>
              <% else %>
                <span style="background-color: <%= ship_status_color %>; color: white; border-radius: 9999px; padding: 2px 10px; font-size: 0.85em; font-weight: 600;">
                  <%= ship_status_label %>
                </span>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </header>

    <% if project.description.present? %>
      <div class="project-show-card__description"><%= helpers.md project.description %></div>
    <% end %>

    <% if has_any_links? %>
      <div class="project-show-card__actions">
        <% if project.demo_url.present? %>
          <%= render ButtonComponent.new(
                text: "Demo",
                href: project.demo_url,
                color: :brown,
                variant: :borderless,
                icon: "icons/globe.svg"
              ) %>
        <% end %>
        <% if project.repo_url.present? %>
          <%= render ButtonComponent.new(
                text: "Repository",
                href: project.repo_url,
                color: :brown,
                variant: :borderless,
                icon: "icons/merge.svg"
              ) %>
        <% end %>
        <% if project.readme_url.present? %>
          <%= render ButtonComponent.new(
                text: "Readme",
                href: project.readme_url,
                color: :brown,
                variant: :borderless,
                icon: "icons/paper.svg"
              ) %>
        <% end %>
      </div>
    <% end %>
  </div>
</article>

<% if owner? && has_feedback? %>
  <div id="ship-feedback-modal-<%= project.id %>" class="modal" data-controller="modal" style="display: none; position: fixed; inset: 0; z-index: 1000; justify-content: center; align-items: center;">
    <div data-action="click->modal#close" style="position: absolute; inset: 0; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px);"></div>
    <div style="background: var(--color-cream, #fef3e2); border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; position: relative; z-index: 1001;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h2 style="margin: 0; color: var(--color-brown);">Ship Feedback</h2>
        <button type="button" data-action="click->modal#close" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--color-brown);">&times;</button>
      </div>

      <div style="margin-bottom: 16px;">
        <span style="background-color: <%= ship_status_color %>; color: white; border-radius: 9999px; padding: 4px 12px; font-size: 0.9em; font-weight: 600;">
          <%= ship_status_label %>
        </span>
      </div>

      <% if ship_feedback_reason.present? %>
        <div style="margin-bottom: 16px;">
          <h3 style="margin: 0 0 8px 0; color: var(--color-brown); font-size: 1em;">Reason</h3>
          <p style="margin: 0; color: var(--color-brown-dark);"><%= ship_feedback_reason %></p>
        </div>
      <% end %>

      <% if ship_feedback_video_url.present? %>
        <div>
          <h3 style="margin: 0 0 8px 0; color: var(--color-brown); font-size: 1em;">Video Feedback</h3>
          <video controls style="width: 100%; max-height: 300px; border-radius: 8px; background: #000;">
            <source src="<%= ship_feedback_video_url %>" type="video/mp4">
            Your browser does not support the video tag.
          </video>
          <a href="<%= ship_feedback_video_url %>" target="_blank" rel="noopener" style="display: block; margin-top: 8px; color: var(--color-blue); text-decoration: underline; font-size: 0.85em;">
            Open in new tab
          </a>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
